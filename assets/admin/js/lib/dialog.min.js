/*! dialogs-manager v2.0.0 | (c) Kobi Zaltzberg | https://github.com/cobicarmel/dialogs-manager/blob/master/LICENSE.txt 
 2016-06-09 16:38 */
!function(a,b){"use strict";var c={widgetsTypes:{},createWidgetType:function(b,d,e){e||(e=this.Widget);var f=function(){e.apply(this,arguments)},g=f.prototype=new e(b);return a.extend(g,d),g.constructor=f,f.extend=function(a,b){return c.createWidgetType(a,b,f)},f},addWidgetType:function(a,b,c){return b&&b.prototype instanceof this.Widget?this.widgetsTypes[a]=b:this.widgetsTypes[a]=this.createWidgetType(a,b,c)},getWidgetType:function(a){return this.widgetsTypes[a]}};c.Instance=function(){var b=this,d={},e={},f=function(){d.$body=a("body")},g=function(b){var c={classPrefix:"dialog",effects:{show:"fadeIn",hide:"fadeOut"}};e=a.extend(c,b)};this.createWidget=function(a,d){var e=c.getWidgetType(a),f=new e(a);return d=d||{},f.init(b,d),f.setMessage(d.message),d.linkedElement&&f.linkElement(d.linkedElement,f),f},this.getSettings=function(a){return a?e[a]:Object.create(e)},this.init=function(a){return g(a),f(),b},this.popDialog=function(a){Widget.show()},b.init()},c.Widget=function(b){var d=this,e={},f={},g={$element:0},h=function(b){var c=e.effects[b],d=g.$widget;if(a.isFunction(c))c.call(d);else{if(!d[c])throw"Reference Error: The effect "+c+" not found";d[c]()}},i=function(){d.addComponent("widget"),d.addComponent("message");var a=d.getSettings("id");a&&d.getComponents("widget").attr("id",a)},j=function(c,f){var g=c.getSettings();e=d.getDefaultSettings(),e.effects=g.effects;var h=g.classPrefix+"-"+b;e.classes={globalPrefix:g.classPrefix,prefix:h,widget:"dialog-widget",linkedActive:h+"-linked-active"},a.extend(!0,e,f)},k=function(a){return a.replace(/([a-z])([A-Z])/g,function(){return arguments[1]+"-"+arguments[2].toLowerCase()})};this.addComponent=function(b,c,d){var f=g["$"+b]=a(c||"<div>"),h=e.classes.prefix+"-";return b=k(b),h+=b,d||(d=b),h+=" "+e.classes.globalPrefix+"-"+d,f.addClass(h),f},this.getSettings=function(a){var b=Object.create(e);return a?b[a]:b},this.init=function(a,b){if(!(a instanceof c.Instance))throw"The "+d.widgetName+" must to be initialized from an instance of DialogsManager.Instance";return d.trigger("init",b),j(a,b),i(),d.buildWidget(),d.attachEvents&&d.attachEvents(),d.trigger("ready"),d},this.getComponents=function(a){return a?g["$"+a]:g},this.hide=function(){return h("hide"),g.$element.length&&g.$element.removeClass(e.classes.linkedActive),d.trigger("hide"),d},this.linkElement=function(a){return this.addComponent("element",a),d},this.on=function(a,b){return f[a]||(f[a]=[]),f[a].push(b),d},this.setMessage=function(a){return g.$message.html(a),d},this.show=function(a,b){return a&&a.stopPropagation(),g.$widget.appendTo("body"),h("show"),g.$element.length&&g.$element.addClass(e.classes.linkedActive),d.trigger("show",b),d},this.trigger=function(b,c){var e="on"+b[0].toUpperCase()+b.slice(1);d[e]&&d[e](c);var g=f[b];g&&a.each(g,function(a,b){b.call(d,c)})}},c.Widget.prototype.buildWidget=function(){var a=this.getComponents();a.$widget.html(a.$message)},c.Widget.prototype.getDefaultSettings=function(){return{}},c.Widget.prototype.onHide=function(){},c.Widget.prototype.onShow=function(){},c.Widget.prototype.onInit=function(){},c.Widget.prototype.onReady=function(){},c.addWidgetType("tool-tip",{onShow:function(){var a=this.getComponents();a.$element.length&&(a.$widget.position({at:"left top-5",my:"left+10 bottom",of:a.$element,collision:"none none"}),a.$element.focus()),setTimeout(this.hide,5e3)}}),c.addWidgetType("options",{activeKeyUp:function(a){var b=13;a.which!==b&&a.preventDefault(),this.hotKeys[a.which]&&this.hotKeys[a.which](this)},activeKeyDown:function(a){var b=9,c=13;if(a.which!==c&&a.preventDefault(),a.which===b){var d,e=this.focusedButton.index();a.shiftKey?(d=e-1,0>d&&(d=this.buttons.length-1)):(d=e+1,d>=this.buttons.length&&(d=0)),this.focusedButton=this.buttons[d].focus()}},addButton:function(b){var c=this,d=c.addComponent(b.name,a("<button>").text(b.text));c.buttons.push(d);var e=function(){c.hide(),a.isFunction(b.callback)&&b.callback.call(this,c)};return d.on("click",e),b.hotKey&&(this.hotKeys[b.hotKey]=e),this.getComponents("buttonsWrapper").append(d),b.focus&&(this.focusedButton=d),c},bindHotKeys:function(){var b=this;b.bindKeyUpEvents=function(a){b.activeKeyUp(a)},b.bindKeyDownEvents=function(a){b.activeKeyDown(a)},a(window).on({keyup:b.bindKeyUpEvents,keydown:b.bindKeyDownEvents})},buildWidget:function(){var a=this.addComponent("widgetHeader"),b=this.addComponent("widgetContent"),c=this.addComponent("buttonsWrapper"),d=this.getComponents();b.append(a,d.$message,c),d.$widget.html(b)},getDefaultSettings:function(){return{position:{my:"center",at:"center center-100"},headerMessage:""}},onHide:function(){this.unbindHotKeys()},onInit:function(){this.buttons=[],this.hotKeys={},this.focusedButton=null},onReady:function(){this.setHeaderMessage(this.getSettings("headerMessage"))},onShow:function(b){var c=this.getComponents(),d=this.getSettings("position");d.of=c.$widget,b&&a.extend(d,b),c.$widgetContent.position(d),this.bindHotKeys(),this.focusedButton||(this.focusedButton=this.buttons[0]),this.focusedButton&&this.focusedButton.focus()},setHeaderMessage:function(a){return this.getComponents("widgetHeader").html(a),this},unbindHotKeys:function(){a(window).off({keyup:this.bindKeyUpEvents,keydown:this.bindKeyDownEvents})}}),c.addWidgetType("confirm",c.getWidgetType("options").extend("confirm",{onReady:function(){c.getWidgetType("options").prototype.onReady.apply(this,arguments);var a=this.getSettings("strings"),b=27,d="cancel"===this.getSettings("defaultOption");this.addButton({name:"cancel",text:a.cancel,callback:this.getSettings("onCancel"),hotKey:b,focus:d}),this.addButton({name:"ok",text:a.confirm,callback:this.getSettings("onConfirm"),focus:!d})},getDefaultSettings:function(){var a=c.getWidgetType("options").prototype.getDefaultSettings.apply(this,arguments);return a.strings={confirm:"Ok",cancel:"Cancel"},a.defaultOption="cancel",a}})),c.addWidgetType("alert",c.getWidgetType("options").extend("alert",{onReady:function(){var a=this.getSettings("strings");this.addButton({name:"ok",text:a.confirm,callback:this.getSettings("onConfirm")})},getDefaultSettings:function(){var a=c.getWidgetType("options").prototype.getDefaultSettings.apply(this,arguments);return a.strings={confirm:"Ok"},a}})),c.addWidgetType("popup",{getDefaultSettings:function(){return{position:{my:"center",at:"center",of:window},hide:{delay:5e3}}},onShow:function(){var a=this.getComponents("message");a.position(this.getSettings("position")),setTimeout(this.hide,this.getSettings("hide").delay)}}),b.DialogsManager=c}("function"==typeof require?require("jquery"):jQuery,"undefined"!=typeof module&&module.exports||window);